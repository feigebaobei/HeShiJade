<section class="content-box">
    <h1>数据存取原理</h1>
    <pre>
        
                            |----------------|
              上传配置数据    |                |   提供配置数据
                --------->  |    server      | ----------
                | --------- |   缓存配置数据   |          |
                | |         |----------------|          |
                | |下载配置数据                           |
                | V                                     V
        |----------------|                       |----------------|
        |                |                       |                |
        |   constructor  |                       |    renderer    |
        |   提供gui能力   |                       |     渲染组件     |
        |   创建配置数据   |                       |    处理组件联动  |
        |----------------|                       |----------------|

    </pre>
    <h1>概念介绍</h1>
    <ul>
        <li>搭建侧`constructor`：用于创建、编辑应用的部分。产生配置数据。</li>
        <li>渲染侧`renderer`：使用配置数据沉浸出组件。处理组件之间联动逻辑。正确运行页面逻辑。</li>
        <li>服务侧`server`：提供服务能力的项目。特指server.</li>
        <li>搭建者：使用搭建侧创建、编辑应用的人。</li>
        <li>浏览者：浏览渲染侧渲染结果的人。</li>
    </ul>
    <h1>目录结构</h1>
    <pre>
        root
        |--packages
            |--components      组件包（未使用）
            |--constructor     搭建侧
            |--mock-server     模拟三方的服务器
            |--renderer        渲染侧
            |--server          服务侧
        |--README.md
        
    </pre>
    <h1>uml</h1>
    <h2>用例图</h2>
    <pre>
        搭建者-----创建应用
               |--编辑应用
               |--发布应用
               |--浏览应用

        浏览者-----浏览应用
    </pre>
    <h2>顺序图</h2>
    <pre>
        搭建侧                                  服务侧                       渲染侧

        增删改查创建应用、页面、组件
        在前端的相应的service中增删改查
        请求增删改查 ------------------------> 维护数据
        
        发布新版本
        设置一个大于dev环境版本的版本号
        点击“发布” -----------------------> 指定应用从源环境复制到目标环境
                                        删除目标环境的指定应用的旧数据

                                                  <---------------- 根据环境、应用、页面请求数据
                                            返回相应数据 -------------> 以动态组件方式渲染每个组件
                                                                    组件之间使用signal处理联动数据
                                                            源组件发送数据，目标组件接收数据并执行相应逻辑

    </pre>
    <h2>数据流图</h2>
    <pre>
        |-----constructor-----------|                   |--service----|                     |---renderer------------|              |---mock-server---|
        |                           |  app/appList      |             |   app详情            |                       |              |                 |
        |    app.service.ts  -------|-------------------|             |---------------------|-- app.service.ts      |              |                 |
        |                           |                   |             |                     |                       |              |                 |
        |                           |                   |             |                     |                       |              |                 |
        |                           |  page/pageList    |             |   pageList          |                       |              |                 |
        |    page.service.ts  ------|-------------------|             |---------------------|-- page.service.ts     |              |                 |
        |                           |                   |             |                     |                       |              |                 |
        |                           |                   |             |                     |                       |              |                 |
        |                           | copmonents(包括：  |             |                     |                       |              |                 |
        |                           | props/behavior/   |             |                     |                       |              |                 |
        |                           | items)/           |             |                     |                       |              |                 |
        |                           | componentsList/   |             |  componentList      |                       |              |                 |
        |                           | items             |             |---------------------|-component.service.ts  |              |                 |
        |    components.service.ts -|-------------------|             |                     |   |                   |              |                 |
        |                           |                   |             |                     |   |                   |              |                 |
        |                           |                   |             |                     |   | props/            |              |                 |
        |                           |                   |             |                     |   | behavior/         |              |                 |
        |                           |                   |             |                     |   | items             |              |                 |
        |                           |                   |             |                     |   |                   |  data        |                 |
        |                           |                   |             |                     |   | data.service.ts --|--------------|                 |
        |                           |                   |             |                     |   |   |               |              |                 |
        |---------------------------|                   |-------------|                     |   |   |data           |              |-----------------|
                                                                                            |   |   |               |
                                                                                            |   component           |
                                                                                            |                       |
                                                                                            |                       |
                                                                                            |-----------------------|
    </pre>
    <h2>模块图（组件图）</h2>
    搭建侧
    <pre>
        |------------------------------------------------------------------|
        |  app-page-list       |  app-comp-box   |   app-props-box         |
        |  页面列表             |  舞台区的组件     |   props属性              |
        |                      |                 |                         |
        |  app-component-list  |                 |   app-behavior-box      |
        |  组件列表             |                 |   行为属性                |
        |                      |                 |                         |
        |                      |                 |   app-items-box         |
        |                      |                 |   items元素              |
        |------------------------------------------------------------------|
    </pre>
    渲染侧
    <pre>
        |------------------------------------------------------------|
        |  app-page-list   |      app-stack                          |
        |  页面列表         |      渲染所有组件                         |
        |------------------------------------------------------------|
    </pre>
    组件库（doing）
    <h2>用户逻辑</h2>
    <p>sso项目管理用户数据。低代码项目使用sso提供的用户数据。低代码项目中的用户表使用userId为惟一键与应用关联。</p>
    <p>注册逻辑（详情见sso(doing)）</p>
    <ol>
        <li>录入用户信息</li>
        <li>提交给idp</li>
        <li>idp返回用户数据到client</li>
        <li>client再把用户数据给sp</li>
        <li>sp种cookie</li>
        <li>进入应用列表页面</li>
    </ol>
    <p>登录逻辑（相似）</p>
    <h2>发布逻辑</h2>
    <ol>
        <li>检查参数</li>
        <li>若源环境是dev，则更新dev环境的版本号。</li>
        <li>从源环境读取应用的数据</li>
        <li>记录目标环境要删除的页面数据、组件数据</li>
        <li>在目标环境写入页面数据、组件数据</li>
        <li>删除目标环境的应用数据，写入目标环境的应用数据。</li>
        <li>删除目标环境的页面数据、组件数据</li>
    </ol>
    <h2>布局逻辑</h2>
    <h3>井布局逻辑</h3>
    <pre>
        |-----------------|
        |十十十十十十十十十十|
        |十十十十十十十十十十|
        |十十十十十十十十十十|
        |-----------------|
    </pre>
    <p>基于“数据存取原理”设计栅格化逻辑。</p>
    <p>搭建侧使用Component.GridLayout.x/y/w/h渲染出组件的原始位置、大小。当改变时重新设置这4个字段。</p>
    <p>搭建侧使用绝对定位。不允许浮动（就是当前组件不能与上面的组件间隔若干网格单位）。渲染侧使用GridStack布局，且不能改变位置、大小。</p>
    <pre>
        
                            |----------------|
            2.上传配置数据    |                |   3.提供配置数据
                --------->  |    server      | ----------
                | --------- |   缓存配置数据   |          |
                | |         |----------------|          |
                | |1. 下载配置数据                        |
                | V                                     V
        |----------------|                       |----------------------|
        |                |                       |                      |
        |   constructor  |                       |    renderer          |
        |   渲染布局      |                       | 全局范围内定义百分比布局 |
        |   提供gui能力   |                       |    渲染组件            |
        |----------------|                       |----------------------|

    </pre>
    <ul>
        <li>grid-w1: 8.333vw</li>
        <li>...</li>
        <li>grid-w12: 100vw</li>
        <li>grid-h1: 8.333vw</li>
        <li>...</li>
        <li>grid-h12: 100vw</li>
        <li>grid-x0: 8.333vw</li>
        <li>...</li>
        <li>grid-x11: 100vw</li>
        <li>grid-y0: 8.333vw</li>
        <li>...</li>
        <li>grid-y11: 100vw</li>
    </ul>
    <h3>列布局逻辑</h3>
    <pre>
        |-----------------|
        | | | | | | | | | |
        | | | | | | | | | |
        | | | | | | | | | |
        |-----------------|
    </pre>
    <p>待开发</p>
    <h3>行布局逻辑</h3>
    <p>待开发</p>
    <p>渲染侧使用百分比方式渲染组件的位置、大小。样式的数值保留小数点后3位，且向下取整。样式的单位是vw。</p>
    <pre>
        |-----------------|
        |-----------------|
        |-----------------|
        |-----------------|
        |-----------------|
    </pre>
    <h3>自动布局逻辑</h3>
    <p>待开发</p>
    <pre>
        |-----------------|
        |                 |
        |                 |
        |                 |
        |-----------------|
    </pre>
</section>